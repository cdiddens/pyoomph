name: PyTest

on:
  workflow_dispatch:

jobs:
  PyTest:
    name: PyTest on ${{ matrix.os }}
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        # macos-13 is an intel runner, macos-14 is apple silicon
        os: [ubuntu-latest]

    steps:
    - uses: actions/checkout@v4
    
    - name: Set up Python
      uses: actions/setup-python@v5
      with: 
         python-version: "3.12"

    - name: Install pytest and deps
      run: python -m pip install pyoomph

    - name: Apt install required libs
      run: sudo apt install libglu1-mesa libxcursor1 libopengl0
      
    - name: Install pyoomph
      run: python -m pip install -i https://test.pypi.org/simple/ pyoomph --no-deps
      # TODO: Adjust the repository from testing and do not install deps before

    - name: Run Self test
      run: cd tests/ && python -m pyoomph check all    
      
    - name: Run PyTest
      run: python -m pytest *.py
